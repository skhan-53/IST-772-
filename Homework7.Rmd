---
title: "Homework 7"
author: "Sana Khan"
date: "2022-11-24"
output: html_document
---
I completed this homework by myself and with help from the textbook

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

3. Run cor.test() on the correlation between “area” and “perm” in the rock data set and interpret the results. Note that you will have to use the “$” accessor to get at each of the two variables (like this: rock$area). Make sure that you interpret both the confi‐ dence interval and the p-value that is generated by cor.test().

```{r cars}
data(rock)
View(rock)

cor.test(rock$area,rock$perm)


```
The 95% confidence interval ranges from -.612 to -.127, which is a small ranger that does not cross 0. We also have a p-value of .005 which is less than our alpha. Based on the confidence interval and the p-value being less than alpha, we would reject the null hypothesis that correlation is 0. Our test shows that there is a negative correlation of -.4


4.Create a copy of the bfCorTest() custom function presented in this chapter. Don’t for‐ get to “source” it (meaning that you have to run the code that defines the function one time to make R aware of it). Conduct a Bayesian analysis of the correlation between “area” and “perm” in the rock data set.
```{r pressure, echo=FALSE}
library(BayesFactor)

bfCorTest <- function (x,y) # Get r from BayesFactor
{
  zx <- scale(x) # Standardize X
  zy <- scale(y) # Standardize Y
  zData <- data.frame(x=zx,rhoNot0=zy) # Put in a data frame
  bfOut <- generalTestBF(x ~ rhoNot0, data=zData) # linear coefficient
  mcmcOut <- posterior(bfOut,iterations=10000) # posterior samples
  print(summary(mcmcOut[,"rhoNot0"])) # Get the HDI for rho
  return(bfOut) # Return Bayes factor object
}

bfCorTest(rock$area, rock$perm)
```
The Bayes model shows that the mean correlation between rock and permeability is  -.35 which is less than the result from the cor test. We also have a wider range from the  HDI which is -.61 to -.08 and the rhoNot0 shows 8:1 in favor of rejecting the null hypothsis. 

8. Not unexpectedly, there is a data set in R that contains these data. The data set is called UCBAdmissions and you can access the department mentioned above like this: UCBAdmissions[ , ,1]. Make sure you put two commas before the 1: this is a three dimensional contingency table that we are subsetting down to two dimensions. Run chisq.test() on this subset of the data set and make sense of the results.
```{r}
UCBA <- UCBAdmissions[,,1]
UCBA

chisq.test(UCBA, correct=F)

```

The chis-square tests shows us that we have a value of 17.25 with 1 degree of freedom and a very low p-value. Based on these results, we can reject the null hypothesis and say that the two factors are not independent. In this case, males have a higher chance of being rejected from being admitted into UCB


 9.Use contingencyTableBF() to conduct a Bayes factor analysis on the UCB admissions data. Report and interpret the Bayes factor.
```{r}
ucbOut <- contingencyTableBF(UCBA,sampleType="poisson", posterior=F)
summary(ucbOut)
```
 
 The Bayes factor results has a ratio of 1111:1 in favor of the alternate hypothesis. This is a high ratio which further supports that these variables are not independent. 
 
 
 
 10.Using the UCBA data, run contingencyTableBF() with posterior sampling. Use the results to calculate a 95% HDI of the difference in proportions between the columns.
 
```{r}
ucbOut <- contingencyTableBF(UCBAdmissions[,,1], sampleType="poisson", 
                             posterior=T, iterations = 10000)
# Calculate admission status proportions for males
maleProp <- ucbOut[,"lambda[1,1]"]/ucbOut[,"lambda[2,1]"]
hist(maleProp)

# Calculate admission status proportions for females
femaleProp <- ucbOut[,"lambda[1,2]"]/ucbOut[,"lambda[2,2]"]
hist(femaleProp)

# Calculate the difference between males and females
propDiffs <- maleProp - femaleProp

# Plot the differences and include the 95% HDI lines.
hist(propDiffs, 
     main="Histogram of Proportion Differences - Male vs. Female", 
     col="darkslategray4", xlab="DIfference")
abline(v=quantile(propDiffs,c(0.025)), col="black")
abline(v=quantile(propDiffs,c(0.975)), col="black")
mean(propDiffs)

# Print the HDI interval
c(quantile(propDiffs,c(0.025)),quantile(propDiffs,c(0.975)))

```
 The histogram shows that males admission is near 1.6 whereas female admission is closer to 5. Plotting the difference shows a mean around -3 which is similar to what the cor.test shows as the mean. Our HDI shows that the range is -6.03 to -1.21, which is similar to the results from the other experiments. Since our range does not span 0, we can reject the null hypothesis. 
